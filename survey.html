<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Modern Health Survey</title>
    <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
            rel="stylesheet"
    />
    <script
            src="https://kit.fontawesome.com/a2d0b5f4d1.js"
            crossorigin="anonymous"
    ></script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to right, #f0fdf4, #ccfbf1);
            background-image: url('https://images.unsplash.com/photo-1588776814546-3cdb690717b3?auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-attachment: fixed;
        }

        .container {
            max-width: 800px;
            margin: 40px auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            animation: fadeIn 1s ease;
        }

        .card {
            width: 190px;
            height: 254px;
            border-radius: 50px;

        }

        .main-title {
            text-align: center;
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 30px;
            background-color: #e0f2fe;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            color: #0f172a;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: medium;
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: 600;
            color: #1e293b;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px;
            margin-top: 6px;
            border-radius: 12px;
            border: 1px solid #94a3b8;
            font-size: 16px;
            transition: 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: #0ea5e9;
            outline: none;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.3);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.8s ease;
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            background-color: #0ea5e9;
            color: white;
            border: none;
            padding: 12px 24px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn:hover {
            background-color: #0284c7;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .result-box {
            background-color: #fcf7dc;
            padding: 20px;
            border-left: 6px solid #bac522;
            border-radius: 10px;
            margin-top: 25px;
            font-weight: 600;
            animation: fadeIn 1s ease;
        }

        select option {
            font-size: 16px;
        }

        @media screen and (max-width: 600px) {
            .buttons {
                flex-direction: column;
                gap: 10px;
            }
        }

        label i {
            margin-right: 8px;
            color: #0ea5e9;
            animation: floatIcon 3s infinite ease-in-out;
        }

        @keyframes floatIcon {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-3px);
            }
        }

        .result-dynamic {
            padding: 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 17px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .result-dynamic i {
            margin-right: 10px;
            color: #1e40af;
        }

        :focus {
            outline: 0;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 4px #b5c9fc;
        }

        .mydict div {
            display: flex;
            flex-wrap: wrap;
            margin-top: 0.1rem;
            justify-content: start;
        }

        .mydict input[type="radio"] {
            clip: rect(0 0 0 0);
            clip-path: inset(100%);
            height: 1px;
            overflow: hidden;
            position: absolute;
            white-space: nowrap;
            width: 1px;
        }

        .mydict input[type="radio"]:checked + span {
            box-shadow: 0 0 0 0.0625em #0ea5e9;
            background-color: #dee7ff;
            z-index: 1;
            color: #0ea5e9;
        }

        label span {
            display: block;
            cursor: pointer;
            background-color: #fff;
            padding: 0.375em .75em;
            position: relative;
            margin-left: .0625em;
            box-shadow: 0 0 0 0.0625em #b5bfd9;
            letter-spacing: .05em;
            color: #3e4963;
            text-align: center;
            transition: background-color .5s ease;
        }

        label:first-child span {
            border-radius: .375em 0 0 .375em;
        }

        label:last-child span {
            border-radius: 0 .375em .375em 0;
        }

        button {
            color: #090909;
            padding: 0.7em 1.7em;
            font-size: 18px;
            border-radius: 0.5em;
            background: #e8e8e8;
            cursor: pointer;
            border: 1px solid #e8e8e8;
            transition: all 0.3s;
            box-shadow: 6px 6px 12px #c5c5c5, -6px -6px 12px #ffffff;
        }


        button:active {
            box-shadow: 4px 4px 12px #c5c5c5, -4px -4px 12px #ffffff;
        }

        #backgroundCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1; /* behind your UI */
            pointer-events: none; /* clicks pass through */
        }

    </style>
</head>
<body>
<canvas id="backgroundCanvas"></canvas>
<div class="container">
    <div class="main-title">
        <i class="fas fa-heartbeat"></i> Yurak qon tomir tizimi kasalliklari xavf omillarini erta aniqlash
        "Kardio-Anketa"si
    </div>
    <form id="surveyForm">
        <!-- Section 1 -->
        <div class="section active" id="section-1">
            <h2><i class="fas fa-hospital-alt"></i> 1-bo'lim : Umumiy ma'lumotlar</h2>
            <label>Viloyat nomi:</label>
            <div class="select-container">
                <i class="fas fa-map-marker-alt"></i>
                <select id="region" required onchange="loadDistricts(this.value)">
                    <option value="">Tanlang</option>
                    <option value="Toshkent">Toshkent</option>
                    <option value="Toshkent City">Toshkent shahri</option>
                    <option value="Samarqand">Samarqand</option>
                    <option value="Andijon">Andijon</option>
                    <option value="Buxoro">Buxoro</option>
                    <option value="Namangan">Namangan</option>
                    <option value="Farg\'ona">Farg'ona</option>
                    <option value="Qashqadaryo">Qashqadaryo</option>
                    <option value="Surxondaryo">Surxondaryo</option>
                    <option value="Jizzax">Jizzax</option>
                    <option value="Xorazm">Xorazm</option>
                    <option value="Navoiy">Navoiy</option>
                    <option value="Sirdaryo">Sirdaryo</option>
                </select>
            </div>
            <label>Tuman yoki shahar nomi:</label>
            <select id="district" required>
                <option value="">Tanlang</option>
            </select>

            <label>Tibbiy muassasa nomi:</label>
            <input type="text" id="hospital" required/>

            <label>Shifokor ismi sharifi:</label>
            <input type="text" id="doctor" required/>

            <div class="buttons">
                <button type="button" class="btn" onclick="nextSection()">Keyingi</button>
            </div>
        </div>

        <!-- Section 2 -->
        <div class="section" id="section-2">
            <h2><i class="fas fa-user-md"></i> 2-Bo'lim : Mijoz ma'lumotlari</h2>
            <label>Mijoz ismi sharifi:</label>
            <input type="text" id="name" required/>

            <label>Yoshi:</label>
            <select id="age" required></select>

            <label>Jinsi:</label>
            <div id="sex" class="mydict">
                <div>
                    <label>
                        <input type="radio" name="gender" value="Erkak" required/>
                        <span>Erkak</span>
                    </label
                    >
                    <label>
                        <input type="radio" name="gender" value="Ayol" required/>
                        <span>Ayol</span>
                    </label
                    >
                </div>
            </div>

            <label>Bo'yi (sm):</label>
            <input type="number" id="height" placeholder="175" min="50" required/>

            <label>Vazni (kg):</label>
            <input type="number" id="weight" placeholder="70" min="10" required/>

            <div class="buttons">
                <button type="button" class="btn" onclick="prevSection()">Oldingi</button>
                <button type="button" class="button" onclick="calculateAndShowBmi()">Tana massa indeksini hisoblash
                </button>
                <button type="button" class="btn" onclick="nextSection()">Keyingi</button>
            </div>
            <div id="result" class="result-box"
                 style="display:none; margin-top:40px; font-size:18px;"></div>
        </div>

        <!-- Section 3 -->
        <div class="section" id="section-3">
            <h2><i class="fas fa-heartbeat"></i> 3-bo'lim : Sog'liq ko'rsatkichlari</h2>

            <label>1. Chekish:</label>
            <select data-points required>
                <option value="">Tanlang</option>
                <option value="0">Chekmaydi</option>
                <option value="3">1-10 sigaret/sutkada</option>
                <option value="8">10+ sigaret/sutkada</option>
                <option value="2">Tashlagan</option>
            </select>

            <label>2. Jismoniy faollik:</label>
            <select data-points required>
                <option value="">Tanlang</option>
                <option value="2">Har kuni faol yurish</option>
                <option value="6">Jismoniy faollik yo'q</option>
            </select>

            <label>3. Ovqatlanish:</label>
            <select data-points required>
                <option value="">Tanlang</option>
                <option value="0">Sog'lom ovqatlanish</option>
                <option value="1">O'rtacha</option>
                <option value="3">Ko'p yog'li ovqatlar</option>
                <option value="7">Chegaralanmagan</option>
            </select>

            <label>4. Ortiqcha vazn semizlik (Tana massa indeksiga ko'ra)</label>
            <select data-points required>
                <option value="">Tanlang</option>
                <option value="0">18 - 25 gacha</option>
                <option value="3">25 - 30 gacha</option>
                <option value="5">30 - 35 gacha</option>
                <option value="6">35 dan yuqori</option>
            </select>
            <label>5. Arterial bosim: (mm.sim.ust)</label>
            <select id="q5" data-points required>
                <option value="">Tanlang</option>
                <option value="1">140/90 gacha</option>
                <option value="7">140/90 dan yuqori (ilk marta aniqlangan)</option>
            </select>

            <label>6. Xolesterin:</label>
            <select data-points required>
                <option value="">Tanlang</option>
                <option value="1">5 mmol/l past</option>
                <option value="6">5 mmol/l dan yuqori</option>
            </select>

            <label>7. Qand miqdori: (m mol/l)</label>
            <select id="q7" data-points required>
                <option value="">Tanlang</option>
                <option value="1">6.1 yoki 6.1 dan past</option>
                <option value="6">6.1 dan yuqori (ilk marta aniqlangan)</option>
            </select>

            <label>8. Alkogol:</label>
            <select data-points required>
                <option value="">Tanlang</option>
                <option value="0">Ichmaydi</option>
                <option value="3">1-2 martadan ko'p emas</option>
                <option value="6">Ko'p ichadi</option>
            </select>

            <label>9. Stress(Psixoematsional xolatini nazorat qila olishi: misol uchun, hasad, g'azab,stress):</label>
            <select data-points required>
                <option value="">Tanlang</option>
                <option value="1">ha (nazorat qila olaman)</option>
                <option value="3">ba'zida)</option>
                <option value="6">Yo'q</option>
            </select>

            <div class="buttons" style="justify-content:center; margin-top:30px;">
                <button type="button" class="btn" onclick="prevSection()" style="margin-right: 20px">Oldingi</button>
                <button type="button" class="btn" onclick="calculatePoints()">Yakunlash</button>
            </div>


        </div>
        <div class="section" id="resultSection">
            <div id="resultTotal"></div>

            <div class="buttons" id="reloadBtn" style="display:none; justify-content:center; margin-top:20px;">
                <button type="button" class="btn" onclick="resetForm()">Yangi mijoz qo‚Äòshish</button>
            </div>
        </div>
    </form>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCA-quDv_aoPYSbnnoVh1WMVHHzmKwsOms",
        authDomain: "kardio-anketa.firebaseapp.com",
        projectId: "kardio-anketa",
        storageBucket: "kardio-anketa.firebasestorage.app",
        messagingSenderId: "417497189499",
        appId: "1:417497189499:web:153d7d58b25706e2d166de",
        measurementId: "G-LYN5VRMK8C"
    };
    let bmi_final = 0.0;
    let final_point = 0
    // Populate Age dropdown dynamically (18 to 99)
    const ageSelect = document.getElementById('age');
    for (let i = 25; i <= 99; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        ageSelect.appendChild(option);
    }

    // District options per region
    const districts = {
        'Andijon': ['Andijon', 'Asaka', 'Baliqchi', 'Bo\'ston', 'Buloqboshi', 'Izboskan', 'Jalaquduq', 'Marhamat', 'Oltinko\'l', 'Paxtaobod', 'Qo\'rg\'ontepa', 'Shahrixon', 'Ulug\'nor', 'Xo\'jaobod'],
        'Buxoro': ['Buxoro', 'Olot', 'G\'ijduvon', 'Jondor', 'Kogon', 'Qorako\'l', 'Qorovulbozor', 'Peshku', 'Romitan', 'Shofirkon', 'Vobkent'],
        'Farg\'ona': ['Farg\'ona', 'Beshariq', 'Bog\'dod', 'Buvayda', 'Dang\'ara', 'Furqat', 'Oltiariq', 'Qo\'qon', 'Quva', 'Quvasoy', 'Rishton', 'So\'x', 'Toshloq', 'Uchko\'prik', 'Yozyovon'],
        'Jizzax': ['Jizzax', 'Arnasoy', 'Baxmal', 'Do\'stlik', 'Forish', 'G\'allaorol', 'Mirzacho\'l', 'Paxtakor', 'Yangiobod', 'Zomin', 'Zafarobod', 'Zarbdor'],
        'Namangan': ['Namangan', 'Chortoq', 'Chust', 'Kosonsoy', 'Mingbuloq', 'Norin', 'Pop', 'To\'raqo\'rg\'on', 'Uchqo\'rg\'on', 'Uychi', 'Yangiqo\'rg\'on'],
        'Navoiy': ['Navoiy', 'Karmana', 'Konimex', 'Nurota', 'Qiziltepa', 'Tomdi', 'Uchquduq', 'Xatirchi', 'Zarafshon'],
        'Qashqadaryo': ['Qarshi', 'Dehqonobod', 'G\'uzor', 'Kasbi', 'Kitob', 'Koson', 'Mirishkor', 'Muborak', 'Nishon', 'Qamashi', 'Shahrisabz', 'Yakkabog\'', 'Chiroqchi'],
        'Samarqand': ['Samarqand', 'Bulung\'ur', 'Ishtixon', 'Jomboy', 'Kattaqo\'rg\'on', 'Narpay', 'Nurobod', 'Oqdaryo', 'Paxtachi', 'Payariq', 'Pastdarg\'om', 'Qo\'shrabot', 'Tayloq', 'Urgut'],
        'Sirdaryo': ['Guliston', 'Boyovut', 'Oqoltin', 'Sayxunobod', 'Sardoba', 'Sirdaryo', 'Xovos', 'Mirzaobod', 'Yangiyer'],
        'Surxondaryo': ['Termiz', 'Angor', 'Bandixon', 'Boysun', 'Denov', 'Jarqo\'rg\'on', 'Muzrabot', 'Oltinsoy', 'Qiziriq', 'Qumqo\'rg\'on', 'Sariosiyo', 'Sherobod', 'Sho\'rchi', 'Termiz', 'Uzun'],
        'Toshkent': ['Toshkent', 'Bekobod', 'Bo\'ka', 'Bo\'stonliq', 'Chinoz', 'Oqqo\'rg\'on', 'Ohangaron', 'Parkent', 'Piskent', 'Quyi Chirchiq', 'O\'rtachirchiq', 'Yangiyo\'l', 'Yuqori Chirchiq', 'Zangiota'],
        'Toshkent City': ['Yunusobod', 'Chilonzor', 'Mirzo Ulug\'bek', 'Mirobod', 'Olmazor', 'Sergeli', 'Shayxontoxur', 'Uchtepa', 'Yakkasaroy', 'Yashnobod'],
        'Xorazm': ['Urganch', 'Bog\'ot', 'Gurlan', 'Hazorasp', 'Xiva', 'Xonqa', 'Qo\'shko\'pir', 'Shovot', 'Yangiariq', 'Yangibozor']
    };

    function loadDistricts(region) {
        const districtSelect = document.getElementById('district');
        districtSelect.innerHTML = '<option value="">Tanlang</option>';
        if (region && districts[region]) {
            districts[region].forEach((dist) => {
                const option = document.createElement('option');
                option.value = dist;
                option.textContent = dist;
                districtSelect.appendChild(option);
            });
        }
    }

    const sections = document.querySelectorAll('.section');
    let currentSection = 0;

    function nextSection() {
        // Validate current section inputs
        const current = sections[currentSection];
        const inputs = current.querySelectorAll('input, select');
        for (const input of inputs) {
            if (!input.checkValidity()) {
                input.reportValidity();
                return;
            }
        }
        // Move forward
        if (currentSection < sections.length - 1) {
            sections[currentSection].classList.remove('active');
            currentSection++;
            sections[currentSection].classList.add('active');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    }

    function prevSection() {
        if (currentSection > 0) {
            sections[currentSection].classList.remove('active');
            currentSection--;
            sections[currentSection].classList.add('active');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    }

    function calculateAndShowBmi() {
        console.log('clicked!');
        const age = document.getElementById('age').value;
        const gender = document.querySelector('input[name="gender"]:checked');
        const height = parseFloat(document.getElementById('height').value);
        const weight = parseFloat(document.getElementById('weight').value);
        if (isNaN(height) || isNaN(weight)) {
            alert("Iltimos, bo'y va vaznni to'g'ri kiriting.");
            return;
        }

        const heightM = height / 100;
        const bmi = weight / (heightM * heightM);
        bmi_final = bmi
        const resultBox = document.getElementById('result');
        console.log(`clicked! ${resultBox}`);
        resultBox.style.display = 'block';
        resultBox.style.animation = 'fadeIn 1s ease';
        resultBox.innerHTML = `
    <p><strong>Mijozning tana massa indeksi:</strong> ${bmi.toFixed(1)}</p>
  `;
        console.log(`Mijozning tana massa indeksi ${bmi.toFixed(1)}`)
        resultBox.scrollIntoView({behavior: 'smooth'});
    }

    function getRiskResult(points) {
        if (points <= 7) {
            return {
                message: "Sog‚Äòlom holat üëç: Sog'lom turmush tarzini davom ettiring",
                color: "#22c55e",
                icon: "fa-thumbs-up"
            };
        } else if (points <= 19) {
            return {
                message: "Kichik xavf ‚ö†Ô∏è: Xavf omillarini yo'qotishga harakat qilish kerak",
                color: "#facc15",
                icon: "fa-exclamation-circle"
            };
        } else if (points <= 31) {
            return {
                message: "Rivojlanish xavfi yuqori ‚ùó: Doimiy nazorat va davolanish kerak",
                color: "#f97316",
                icon: "fa-heartbeat"
            };
        } else if (points <= 44) {
            return {
                message: "Rivojlangan xavf: Samarali davolanish va sog'lomlashtirish zarur",
                color: "#fb923c",
                icon: "fa-stethoscope"
            };
        } else {
            return {
                message: "Yuqori xavf ‚ùó: Shoshilinch Kardiolog maslahati va tavsiyasi zarur",
                color: "#dc2626",
                icon: "fa-skull-crossbones"
            };
        }
    }

    function calculatePoints() {
        document.getElementById("resultSection").style.display = "block";
        console.log('Calculating points...');
        const selects = document.querySelectorAll('#section-3 select[data-points]');
        for (let sel of selects) {
            if (!sel.value) {
                alert('Iltimos barcha savollarga javob bering');
                sel.focus();
                return;
            }
        }

        let totalPoints = 0;
        selects.forEach((sel) => {
            totalPoints += parseInt(sel.value);
        });

        console.log('Total points:', totalPoints);

        sections.forEach((s) => s.classList.remove('active'));

        document.getElementById('resultSection').classList.add('active');
        const resultBox = document.getElementById('resultTotal');
        if (!resultBox) {
            console.error('‚ùå ERROR: #resultTotal element not found!');
            return;
        }

        resultBox.style.display = 'block';
        resultBox.style.animation = 'fadeIn 1s ease';

        const riskResult = getRiskResult(totalPoints);
        console.log('Risk result:', riskResult);

        if (!riskResult || !riskResult.color) {
            console.error('‚ùå ERROR: riskResult missing or malformed:', riskResult);
            return;
        }
        final_point = totalPoints
        console.log("final_point" + final_point)
        resultBox.innerHTML = `
    <div class="result-dynamic" style="border-left: 6px solid ${riskResult.color}; background-color: ${hexToRGBA(riskResult.color, 0.15)};">
     <strong>Mijoz ko'rsatkich bali: ${totalPoints}</strong><br><br>
      <i class="fas ${riskResult.icon}"></i> ${riskResult.message}
    </div>
  `;
        document.getElementById('reloadBtn').style.display = 'flex';
        resultBox.scrollIntoView({behavior: 'smooth'});
        submitSurveyData()
    }

    function hexToRGBA(hex, opacity) {
        const bigint = parseInt(hex.replace('#', ''), 16);
        const r = (bigint >> 16) & 255;
        const g = (bigint >> 8) & 255;
        const b = bigint & 255;
        return `rgba(${r}, ${g}, ${b}, ${opacity})`;
    }

    function resetForm() {
        document.getElementById("surveyForm").reset();

        // Hide result section
        document.getElementById("resultSection").style.display = "none";
        document.getElementById("result").style.display = "none";

        // Hide all sections
        document.querySelectorAll(".section").forEach((s) => s.classList.remove("active"));

        // Show first section
        document.getElementById("section-1").classList.add("active");

        // Reset section index
        currentSection = 0;
    }

    (function () {
        const canvas = document.getElementById('backgroundCanvas');
        const ctx = canvas.getContext('2d');

        let width, height;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        window.addEventListener('resize', resize);
        resize();

        // Mouse position for interactivity (if you want line‚Äëto‚Äëmouse)
        const mouse = {x: width / 2, y: height / 2};
        window.addEventListener('mousemove', e => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        });

        // Dot configuration
        const DOT_COUNT = 500;
        const CONNECT_DIST = 60;
        const MOUSE_DIST = 120;

        // Create dot array once
        const dots = [];

        class Dot {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 1;  // speed
                this.vy = (Math.random() - 0.5) * 1;
                this.radius = Math.random() * 1.5 + 0.5;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                // bounce on edges
                if (this.x < 0 || this.x > width) this.vx *= -1;
                if (this.y < 0 || this.y > height) this.vy *= -1;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
                ctx.fillStyle = 'rgba(206,206,206,0.8)';
                ctx.fill();
            }
        }

        // fill the array
        for (let i = 0; i < DOT_COUNT; i++) {
            dots.push(new Dot());
        }

        // Main animation loop
        function animate() {
            ctx.clearRect(0, 0, width, height);

            // draw dots
            dots.forEach(dot => dot.draw());

            // draw lines
            for (let i = 0; i < DOT_COUNT; i++) {
                for (let j = i + 1; j < DOT_COUNT; j++) {
                    const a = dots[i], b = dots[j];
                    const dx = a.x - b.x, dy = a.y - b.y;
                    const dist = Math.hypot(dx, dy);
                    // only if dots are close *and* near the mouse
                    if (dist < CONNECT_DIST &&
                        Math.hypot(a.x - mouse.x, a.y - mouse.y) < MOUSE_DIST &&
                        Math.hypot(b.x - mouse.x, b.y - mouse.y) < MOUSE_DIST) {
                        ctx.beginPath();
                        ctx.moveTo(a.x, a.y);
                        ctx.lineTo(b.x, b.y);
                        ctx.strokeStyle = 'rgba(206,206,206,0.2)';
                        ctx.lineWidth = 0.5;
                        ctx.stroke();
                    }
                }
            }

            // update dot positions
            dots.forEach(dot => dot.update());

            requestAnimationFrame(animate);
        }

        // kick it off
        animate();
    })();


   async function submitSurveyData() {
       // Gather values from the form (use correct IDs or names)
       const region = document.getElementById('region').value;
       const city = document.getElementById('district').value;
       const clinicName = document.getElementById('hospital').value;
       const age_patient = document.getElementById('age').value;
       const patient_gender = document.querySelector('input[name="gender"]:checked').value;
       const patient_height = parseFloat(document.getElementById('height').value);
       const patient_weight = parseFloat(document.getElementById('weight').value);
       const patient_bmi = Math.round(bmi_final * 100) / 100;// BMI formula

       const total_point = final_point // Your scoring logic

       const q5 = document.getElementById('q5').value;
       const q7 = document.getElementById('q7').value;
       console.log(q5)
       console.log(q7)
       const firstTime_ag = q5 === '7' ? 1 : 0;
       const firstTime_at = q7 === '6' ? 1 : 0;

       const current_date = new Date().toISOString().split('T')[0];

       const surveyData = {
           region,
           city,
           clinicName,
           age_patient,
           patient_gender,
           patient_height,
           patient_weight,
           patient_bmi,
           total_point,
           firstTime_ag,
           firstTime_at,
           current_date
       };
       console.log(surveyData)

       // Firebase Modular Import
       const {initializeApp} = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js");
       const {
           getFirestore,
           collection,
           addDoc
       } = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js");

       const app = initializeApp(firebaseConfig);
       const db = getFirestore(app);

       addDoc(collection(db, "survey"), surveyData)
           .then(() => {
               console.log("Survey data submitted successfully!");
           })
           .catch((error) => {
               console.error("Error submitting data: ", error);
           });
   }
</script>


</body>
</html>
